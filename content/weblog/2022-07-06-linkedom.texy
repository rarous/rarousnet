---
{:id 484,
:title "JednoduÅ¡e a rychle: LinkeDOM",
:description "Na prÃ¡ci s HTML dokumenty existuje nÄ›kolik JavaScriptovÃ½ch knihoven a vÄ›tÅ¡inou nejsou dobrÃ©. LinkeDOM je rychlÃ½ a velice blÃ­zkÃ½ APIs browseru.",
:author "AleÅ¡ RoubÃ­Äek",
:tags #{"moje prÃ¡ce" "webdesign" "linkedom" "deno"},
:published "2022-07-06T14:00:00.000"
:syndication ["https://twitter.com/alesroubicek/status/1544668278622232578"]}
---

Pokud chcete v Node.js pracovat s HTML dokumenty, mÃ¡te v podstatÄ› dvÄ› moÅ¾nosti, jak to mainstreamovÄ› udÄ›lat -
cheerio a JSDOM. **Cheerio** je klon jQuery pro Node.js,
kterÃ½ najdete tÅ™eba jako "zÃ¡klad scraperÅ¯ na platformÄ› Apify":[https://apify.com/apify/cheerio-scraper].
**JSDOM** je tÄ›Å¾kotonÃ¡Å¾nÃ­ framework, kterÃ½ se snaÅ¾Ã­ simulovat browser v kontextu Node.js. 
VÄ›tÅ¡inou se pouÅ¾Ã­vÃ¡ pro testovÃ¡nÃ­ frontentovÃ½ch komponent bez nutnosti spouÅ¡tÄ›t celÃ½ browser. Sic.

ObÄ› moÅ¾nosti povaÅ¾uju za nedobrÃ©. AÅ¥ uÅ¾ kvÅ¯li pamÄ›Å¥ovÃ© nÃ¡roÄnosti a 
obecnÃ© neefektivnosti, kterÃ¡ se vztahuje na obÄ› jmenovanÃ¡ Å™eÅ¡enÃ­, 
tak nestandardnÃ­ API, jakÃ© pÅ™edstavuje cheerio. MÃ¡me nÄ›jakÃ© lepÅ¡Ã­ moÅ¾nosti?

LinkeDOM
========

Ano. MÃ¡me. Je jÃ­m "knihovna LinkeDOM":[https://github.com/WebReflection/linkedom],
kterÃ¡ si od zaÄÃ¡tku "klade za cÃ­l bÃ½t efektivnÃ­":[https://webreflection.medium.com/linkedom-a-jsdom-alternative-53dd8f699311]
(jak na pamÄ›Å¥, tak cykly procesoru) a mÃ­t API velmi blÃ­zkÃ© "DOM standardu":[https://dom.spec.whatwg.org/]. 
Dosahuje toho dÃ­ky chytrÃ© volbÄ› vhodnÃ½ch datovÃ½ch struktur pro reprezentaci 
stromovÃ© povahy DOMu - "triple-linked lists":[https://github.com/WebReflection/linkedom#how-does-it-work] -
a nelpÄ›nÃ­ na plnÃ© implementaci DOM standardu.

<aside>
<p>ObecnÄ› se dÃ¡ Å™Ã­ct, Å¾e vÄ›tÅ¡ina vÃ½konovÃ½ch problÃ©mÅ¯ dneÅ¡nÃ­ch webovÃ½ch aplikacÃ­ lÄ›Å¾Ã­
v domÃ©nÄ› reprezentace stavu pomocÃ­ nevhodnÃ½ch datovÃ½ch struktur a pÅ™Ã­stupu k nim.
ZdravÃ­me vÅ¡echny poor-man immutability knihovny pro meneÅ¾ovÃ¡nÃ­ stavu nejen ReactÃ­ch aplikacÃ­. ğŸ‘‹ğŸ–•ğŸ¼
</aside>

Ale zpÃ¡tky k LinkeDOMu. Jak uÅ¾ jsem naznaÄil jde o knihovnu, kterÃ¡ primÃ¡rnÄ› cÃ­lÃ­ na Node.js.
Exportuje vÅ¡ak i ESM moduly, kterÃ© nejsou zÃ¡vislÃ© na internals Node.js a jsou
tak pouÅ¾itelnÃ© i v kontextu Web WorkerÅ¯
"v Browseru":[https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers] i
"v Cloudflare":[https://developers.cloudflare.com/workers/] nebo 
"v bÄ›hovÃ©m prostÅ™edÃ­ Deno":[https://deno.land/manual/jsx_dom/linkedom].

Na co se hodÃ­?
==============

JednÃ­m z cÃ­lÅ¯ LinkeDOM je rychlÃ½ SSR((Server Side Rendering)), ale dÃ¡ se pouÅ¾Ã­t
i pro efektivnÃ­ testovÃ¡nÃ­ komponent nebo web scraping ve vysokÃ©m scale s rozumnÃ½mi nÃ¡klady.

Jak ho tedy pouÅ¾Ã­t?
===================

PouÅ¾itÃ­ je celkem pÅ™Ã­moÄarÃ© - importujeme ES modul `linkedom` a z nÄ›j pouÅ¾ijeme funkci `parseHTML`:

/--code javascript
import { parseHTML } from "https://esm.sh/linkedom";
\--code

DÃ¡le funkci `parseHTML` pÅ™edÃ¡me vstupnÃ­ HTML dokument:

/--code javascript
const { document, customElements, HTMLElement } = parseHTML(`<!DOCTYPE html>
  <html lang="en">
    <head>
      <title>Hello from Deno</title>
    </head>
    <body>
      <h1>Hello from Deno</h1>
      <form>
        <input name="user">
        <button>
          Submit
        </button>
      </form>
    </body>
  </html>
`);
\--
  
To nÃ¡m vrÃ¡tÃ­ "sandbox" globÃ¡lnÃ­ho kontextu (aka `window`), kde najdete podporovanÃ© ÄÃ¡sti DOM standardu.
Super je, Å¾e mÅ¯Å¾ete sdÃ­let kÃ³d pro prÃ¡ci s DOMem mezi serverem i klientem. KÃ³d, kterÃ½ si mÅ¯Å¾ete odladit
v DevTools browseru, bez problÃ©mÅ¯ pÅ™enesete na server. 

Co LinkeDOM nepodporuje, jsou dynamickÃ© vlastnosti:
  
/--code javascript
  const input = document.querySelector("input[name=user]");
  console.log(input.name);
\--

Tohle vÃ¡m v browseru vypÃ­Å¡e `"user"`, ale v LinkeDOM je to `undefined`. 
V tomto pÅ™Ã­padÄ› musÃ­te pouÅ¾Ã­t metodu `getAttribute`:

/--code javascript
  const input = document.querySelector("input[name=user]");
  console.log(input.getAttribute("name"));
\--

Vzhledem k tomu, Å¾e vÅ¡echny atributy stejnÄ› nejsou dynamickÃ© ani v browseru, 
je lepÅ¡Ã­ jÃ­t ukecanÄ›jÅ¡Ã­ cestou tak jako tak. UÅ¾ kvÅ¯li konzistenci.

OsobnÄ› ve svÃ½ch scriptech a actorech uÅ¾ nepouÅ¾Ã­vÃ¡m nic jinÃ©ho. 
ExistujÃ­cÃ­ actory "HlÃ­daÄe shopÅ¯":[https://github.com/topmonks/hlidac-shopu]
postupnÄ› na LinkeDOM pÅ™eklÃ¡pÃ­me pÅ™i nutnÃ© ÃºdrÅ¾bÄ›, kvÅ¯li zmÄ›nÃ¡m sledovanÃ½ch webÅ¯.
KÃ³d je pak pro nÃ¡s pÅ™ehlednÄ›jÅ¡Ã­ pÅ™i ÃºdrÅ¾bÄ› a efektivnÄ›jÅ¡Ã­ v provozu. A to se vyplatÃ­!
